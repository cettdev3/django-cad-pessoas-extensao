{% extends "base.html" %}

{% block content %}
<style>
    .br {
        border: 2px solid red;
    }

    .w-10 {
        width: 10%;
    }

    .w-15 {
        width: 15%;
    }

    .w-2 {
        width: 2%;
    }

    .justify-start {
        display: flex;
        justify-content: flex-start;
    }

    .btn-group-custom button {
        background-color: #fff;
        /* Green background */
        border: 1px solid #e3e6f0;
        /* Green border */
        color: #343a40;
        /* White text */
        padding: 10px 24px;
        /* Some padding */
        cursor: pointer;
        /* Pointer/hand icon */
        float: left;
        /* Float the buttons side by side */
    }

    /* Clear floats (clearfix hack) */
    .btn-group-custom {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }

    .btn-group-custom button:not(:last-child) {
        border-bottom: none;
        /* Prevent double borders */
    }

    /* Add a background color on hover */
    .btn-group-custom button:hover {
        background-color: #e3e6f0;
    }

    .btn-circle {
        border: none;
        outline: inherit;
        background-color: #fff;
        width: auto;
        height: 100%;
        padding: 13px 18px;
        border-radius: 60px;
        font-size: 15px;
        text-align: center;
        transition: background-color 0.1s;
    }

    .btn-cadastrar {
        border: none;
        outline: inherit;
        color: white;
        background-color: #1cc88a;
        width: auto;
        height: 100%;
        padding: 13px 18px;
        border-radius: 60px;
        font-size: 15px;
        text-align: center;
        transition: background-color 0.1s;
    }

    .btn-cadastrar:hover {
        background-color: #15865d;
        transition: background-color 0.1s;
    }

    .btn-circle:active {
        background-color: #ececec;
        transition: background-color 0.1s;
    }

    .active-form-tab {
        background-color: #15865d;
        color: white;
    }
</style>
<div
style="
background-color: rgba(125,125,125,0.3); 
display: none; 
justify-content: center; 
align-items: center; 
width: 100vw; 
height: 100vh;
position: absolute;
overflow: hidden;
top: 0;
left: 0;
z-index: 4
;">
    <div class="spinner-border" style="z-index: 5;" role="status">
        <span class="sr-only">Carregando...</span>
    </div>
</div>
<div style="width: 100%;" class="">
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-dismissible alert-success" role="alert">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <strong class="text-dark">{{message}}</strong>
        </div>
        {% endfor %}
    {% endif %}
    <div class="w-100 shadow
    d-flex justify-content-between align-items-center 
    px-3 py-3 my-3
    bg-white">
        <div>
            <input id="filterAcaoTipo" 
            placeholder="Digite um tipo" 
            class="form-control-sm border-secondary"
            name="tipo" 
            type="text">
        </div>
        <div>
            <button id="adicionarAcao" 
            onclick="carregarAcoesModalCadastrar()"
            class="btn-cadastrar rounded d-flex justify-content-between align-items-center">
                <span> cadastrar acao</span>
            </button>
        </div>
    </div>

    <div class="w-100" id="modalAcao">
    </div>

    <div class="w-100" id="acaoTable">
    </div>

</div>
<script>
    var filterPrefix = "filterAcao"
    var idTabelData = "acaoTable"
    var idModal = "modalAcao"
    var rotaModalAcao = "/acaoModal"
    var rotaTableAcao = "/acaoTable"

    function carregarAcoesModalCadastrar(id = null) {
        let data = {
            id: id
        }
        $.ajax({
            url: rotaModalAcao,
            dataType: "html",
            data: data,
            contentType: "application/json",
            type: "GET",
            success: function (data) {
                $("#"+idModal).html(data);
                $('#'+cadastrarAcaoModalId).modal('toggle');
            }
        });
    }
    
    function carregarAcoes(filter = null) {
        $.ajax({
            url: rotaTableAcao,
            data: filter ? filter : {},
            success: function (data) {
                $("#"+idTabelData).html(data);
            }
        });
    }

    function debounce(func, timeout = 300){
        let timer;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => { func.apply(this, args); }, timeout);
        };
    }

    function filtrarAcao() {
        let filtros = {}
        $("input[id^='"+filterPrefix+"']").each(function() {
            if ($(this).val()) {
                filtros[$(this).attr("name")] = $(this).val()
            }
        })
        console.log(filtros)
        carregarAcoes(filtros)
    }

    function startFilterControl() {
        $("input[id^='"+filterPrefix+"']").each(function () {
            $(this)
            .keyup(debounce(function() {
                filtrarAcao()
            }, 500))
        })
    }

    $(document).ready(function() {
        startFilterControl()
        carregarAcoes()
    })
</script>
{% endblock content %}