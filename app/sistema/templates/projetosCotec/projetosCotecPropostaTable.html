<div class="w-100">
        <table class="table table-hover table-sm table-responsive-md">
            <thead>
                <tr>
                    <th scope="col" class="text-left">Nome</th>
                    <th scope="col" class="text-left">Proponente</th>
                    <th scope="col" class="text-left">Escola</th>
                    <th scope="col" class="text-left">Data de envio</th>
                    <th scope="col" class="text-left">status</th>
                    <th scope="col" class="text-left"></th>
                </tr>
            </thead>
            <tbody id="tbody">
                {% for proposta in propostas %}
                <tr>
                    <td class="text-left">{{ proposta.titulo_projeto|default_if_none:"Não informado" }}</td>
                    {% if proposta.proponentes %}
                    <td class="text-left">
                        {% for proponente in proposta.proponentes %}
                        {% if proponente.pessoa %}
                        <div>{{ proponente.pessoa.nome }}</div>
                        {% else %}
                        <div>Não Informado</div>
                        {% endif %}
                        {% endfor %}
                    </td>   
                    {% else %}
                    <td class="text-left">Não informado</td>
                    {% endif %}
                    {% if proposta.escola %}
                    <td class="text-left">{{ proposta.escola.nome|default_if_none:"Não informado" }}</td>
                    {% else %}
                    <td class="text-left">Não informado</td>
                    {% endif %}
                    {% if proposta.created_at %}
                    <td class="text-left">{{ proposta.created_at|date:"d/m/Y" }}</td>
                    {% else %}
                    <td class="text-left">Não informado</td>
                    {% endif %}
                    <td >
                        <div style="gap: 8px;" 
                        class="d-flex justify-content-start align-items-center">
                            {% if proposta.status == 'aprovada' %}
                            <span class="badge badge-success">
                                {{ proposta.status_formatado }}
                            </span>
                            {% endif %}
                            {% if proposta.status == 'reprovada' %}
                            <span class="badge badge-danger">
                                {{ proposta.status_formatado }}
                            </span>
                            {% endif %}
                            {% if proposta.status == 'em_analise' %}
                            <span class="badge badge-warning">
                                {{ proposta.status_formatado }}
                            </span>
                            {% endif %}
                            {% if proposta.status == 'devolvida' %}
                            <span class="badge badge-danger">
                                {{ proposta.status_formatado }}
                            </span>
                            {% endif %}
                            {% if proposta.status == 'cancelada' %}
                            <span class="badge badge-danger">
                                {{ proposta.status_formatado }}
                            </span>
                            {% endif %}
                            {% if proposta.status == 'rascunho' %}
                            <span class="badge badge-secondary">
                                {{ proposta.status_formatado }}
                            </span>
                            {% endif %}
                            {% if proposta.status == 'devolvida' %}
                                <i 
                                style="border-radius: 50%" 
                                data-toggle="modal" 
                                data-target="#justificativaModal" 
                                data-justificativa="{{ proposta.justificativas }}"
                                data-toggle="tooltip" 
                                data-placement="top" 
                                title="Ver Justificativa"
                                class="fas fa-info-circle cursor-pointer text-warning"></i>
                            {% endif %}
                        </div>
                    </td>
                    <td class="text-left">
                        <div class="d-flex justify-content-end">
                            <div class="btn-group">
                                <button type="button" class="btn-remove-default btn-circle btn-outline-secondary"
                                data-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="dropdown-menu" role="menu">
                                    {% if proposta.evento %}
                                    <a class="dropdown-item cursor-pointer"
                                    href="{% url 'visualizar-dp-evento' proposta.evento.id %}">
                                        Ver Projeto
                                    </a>
                                    {% endif %}
                                    <a href="{% url 'show-proposta-projeto' proposta.id %}"
                                    class="dropdown-item cursor-pointer">
                                        <span> Ver Proposta</span>
                                    </a>
                                    {% if pessoa.instituicao != 'cett' %}
                                    {% if proposta.is_editable  %}
                                    <a href="{% url 'cotec-projeto-form' %}?proposta_id={{ proposta.id }}"
                                    class="dropdown-item cursor-pointer">
                                        <span> Editar Proposta</span>
                                    </a>
                                    {% endif %}
                                    {% endif %}
                                    {% if proposta.is_deleteable  %}
                                    <button class="dropdown-item cursor-pointer btn-excluir-proposta" 
                                    type="button"
                                    data-proposta-projeto-id="{{ proposta.id }}">
                                        Excluir
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div class="modal fade" id="justificativaModal" tabindex="-1" aria-labelledby="justificativaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="justificativaModalLabel">Justificativa</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="justificativaBody">
          <!-- Justificativa will be inserted here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>
<script>
    $(document).ready(function () {
        (function(params) {
            $('.btn-excluir-proposta').on('click', function () {
                var proposta_projeto_id = $(this).data('proposta-projeto-id')
                console.log(proposta_projeto_id)
                removePropostaProjeto(
                    proposta_projeto_id,
                    function (response) {
                        showFloatingMessage("Proposta de projeto removida com sucesso", "alert-success");
                        loadPropostasTable()
                    },
                    function (error) {
                        console.log("erro")
                        console.log(error)
                    }
                )
            })

            $(document).on('click', '[data-toggle="modal"]', function(event) {
                var justificativa = $(this).attr('data-justificativa');
                $('#justificativaBody').text(justificativa);
            });
        })({})
    })
</script>
